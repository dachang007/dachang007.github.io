<!DOCTYPE html><html lang="zh-cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Redis系列1：深刻理解高性能Redis的本质 | 数根朽木，</title><meta name="keywords" content="Redis,Redis原理,缓存,高性能"><meta name="author" content="dachang"><meta name="copyright" content="dachang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#F9F9F9"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Redis系列1：深刻理解高性能Redis的本质"><meta name="application-name" content="Redis系列1：深刻理解高性能Redis的本质"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#F9F9F9"><meta property="og:type" content="article"><meta property="og:title" content="Redis系列1：深刻理解高性能Redis的本质"><meta property="og:url" content="https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/index.html"><meta property="og:site_name" content="数根朽木，"><meta property="og:description" content="1 背景分布式系统绕不开的核心之一的就是数据缓存，有了缓存的支撑，系统的整体吞吐量会有很大的提升。通过使用缓存，我们把频繁查询的数据由磁盘调度到缓存中，保证数据的高效率读写。当然，除了在内存内运行还远远不够，我们今天就以具有代表性的缓存中间件Redis为例子，分析下，它是如何达到飞起的效率。 2 R"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://imags-563.pages.dev/file/AgACAgUAAxkDAANsaUJahYhmpT20C3buqSiwwIky_9gAAp8LaxvvjBBWtjzhzL6BcHEBAAMCAAN3AAM2BA.png"><meta property="article:author" content="dachang"><meta property="article:tag" content="blog, coding, technology, personal"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://imags-563.pages.dev/file/AgACAgUAAxkDAANsaUJahYhmpT20C3buqSiwwIky_9gAAp8LaxvvjBBWtjzhzL6BcHEBAAMCAAN3AAM2BA.png"><meta name="description" content="1 背景分布式系统绕不开的核心之一的就是数据缓存，有了缓存的支撑，系统的整体吞吐量会有很大的提升。通过使用缓存，我们把频繁查询的数据由磁盘调度到缓存中，保证数据的高效率读写。当然，除了在内存内运行还远远不够，我们今天就以具有代表性的缓存中间件Redis为例子，分析下，它是如何达到飞起的效率。 2 R"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: undefined,
  LA51: {"enable":true,"ck":null,"LingQueMonitorID":null},
  greetingBox: undefined,
  twikooEnvId: 'https://twikoo-kohl-zeta.vercel.app',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"该文章距离上次更新已经过去","messageNext":"天了，文章内容可能已经过时，注意甄别。"},
  highlight: {"plugin":"highlight.js","highlightCopy":false,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: dachang","link":"链接: ","source":"来源: 数根朽木，","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '数根朽木，',
  title: 'Redis系列1：深刻理解高性能Redis的本质',
  postAI: '',
  pageFillDescription: '1 背景, 2 Redis高效性能分析, 2.1 官网的性能报告, 2.2 基于内存实现, 2.3 适配多元场景的高效数据结构, 2.3.1 SDS 简单动态字符串, 2.3.2 zipList 压缩列表, 2.3.3 linklist 双端列表, 2.3.4 Hhash 字典, 2.3.5 intset 整数集合, 2.3.6 skipList跳跃表, 2.4 单线程模型, 2.4.1 为何是单线程？, 2.4.2 单线程的好处, 2.4.3 单线程是否有效利用CPU, 2.5 Ix2FO 多路复用模型, 2.5.1 普通 Ix2FO 模型, 2.5.2 Ix2FO 多路复用, 3 高性能Redis总结背景分布式系统绕不开的核心之一的就是数据缓存有了缓存的支撑系统的整体吞吐量会有很大的提升通过使用缓存我们把频繁查询的数据由磁盘调度到缓存中保证数据的高效率读写当然除了在内存内运行还远远不够我们今天就以具有代表性的缓存中间件为例子分析下它是如何达到飞起的效率高效性能分析之所以能够提供超高的执行效率主要从以下几个维度来实现的存储模式基于内存实现而非磁盘数据结构基于不同业务场景的高效数据结构动态字符串整数字符串双端列表压缩列表跳跃表哈希表整数集合线程模型的网络以及键值对指令读写是由单个线程来执行的避免了不必要的和竞选模型基于多路复用模型非阻塞的模型恰单的数据编码根据实际数据类型选择合理的数据编码官网的性能报告官方站点中有对性能做了比较详细的压测可以参考官方这一篇在较高的配置基准下比如在连接数为的时候最高可达到以超过个连接为基准仍然能够在这些条件下维持个体现了超高的性能下图中横轴是连接数纵轴是下面这张图为与整体吞吐量之间的趋向关系这个大概可以得出一个容量预估比如你的服务用户量是多少预估峰值是多少集群需要配置多少个实例虽然实例的多少不能线性计算可以大致推算出去基于内存实现的读写操作都是在内存中实现了相对其他的持久化存储如等数据持久化在磁盘上性能会高很多因为在们在操作数据的时候需要通过操作先将数据读取到内存里增加工作成本上面那张图来源于网络可以看看他的金字塔模型越往上执行效率越高价格也就越贵下面给出每一层的执行耗时对比寄存器高速缓存高速缓存高速缓存主存本地二级存储远程二级存储这样可能不直观我们举个和的对比如果耗时的话中差不多要小时因为内部集成了内存控制器所以直接控制了内存给予通信上的最优带宽上面的部分数据引用自性能之巅洞悉系统企业与云计算适配多元场景的高效数据结构在缓存中常用的主要数据类型有五种如下字符串适用于缓存计数共享统计分布式锁等列表链表消息队列栈有序的对象列表如朋友圈的点赞顺序列表评论顺序列表哈希表购物车信息用户信息类型的存储对象等集合无序的唯一的键值结构好友关注粉丝感兴趣的人集合等有序集合访问排行榜点赞排行粉丝数排行等上面这种支持的数据类型能够满足不同业务场景下的数据结构需求而对于这几类数据类型的区分和支持目的无非也是为了效率具体的业务中使用恰当的数据结构才能保证得到应有的效率这种数据类型都有一种或者多种数据结构来支撑底层数据结构有种关系如下下面我们对这些数据结构一个个的分析简单动态字符串使用简单动态字符串来表示字符串中字符串类型包含的数据结构有整数字符串我们以字符串为例子常规的字符串如如果要获取他的长度需要从头开始遍历直至遇到空字符代表结尾如字符串字符串结构与字符串结构对比图参照如下属性的值为表示这个没有分配任何未使用空间属性的值为表示这个保存了一个字节长度的字符串是一个类型的数组存储真实的字符串数组的前五个字节分别保存了五个字符而最后一个字节则保存了空字符代表结尾注意遵循字符串的惯例以空字符结尾保存空字符的字节不计算在的属性中比起字符串具有以下优点度获取字符串长度时间复杂度为字符串不记录自身长度获取字符串长度时必须遍历整个字符串计数得到复杂度是字符串自身记录维护长度属性获得字符串长度的复杂度是杜绝缓冲区溢出字符串不记录长度由于两个字符串在内存存储上紧邻在执行字符串拼接时如果不提前分配足够空间很可能发生修改的数据溢出到所在的空间中缓冲区溢出杜绝了缓冲区溢出问题它记录了长度当修改字符串之前都会检查的空间是否满足修改的要求不满足会自动进行空间扩展空间预分配减少修改时的内存重分配次数被修改后程序不仅会为分配所需要的空间还会分配额外的未使用空间这样可以减少连续执行字符串增长操作所需的内存重分配次数具体分配未使用空间如下种方式如修改后长度小于就分配和属性相同大小的未使用空间如修改后长度大于等于就分配的未使用空间惰性空间释放缩短操作时避免了缩短字符串时所需的内存重分配操作并为将来可能有的增长操作提供了优化当做缩短操作不会立刻使用内存重分配来收回缩短后多出来的字节而是保持在属性里将来如果需要操作则直接使用中未使用的空间减少了内存的分配步骤另外也提供了手动进行释放未使用空间避免惰性释放策略会造成内存浪费二进制安全字符串的字符必须符合某种编码除结尾空字符以外字符串内部不允许有空字符串存储有局限性而在中不仅可以存储类型的数据也可能存储一些二进制数据二进制数据并不是规则的字符串格式其中会包含一些特殊的字符如在中遇到则表示字符串的结束但不是它是以长度标识结尾兼容部分字符串函数虽然是二进制安全的但还是秉承字符串以空字符结尾的特性很多函数与字符串一致不需要重写压缩列表通过上面的数据结构关系图可以看出压缩列表是三种数据类型底层实现之一当我们的列表数据量比较少的时候且存储的数据轻量的如小整数值短字符串时候就会通过压缩列表来进行底层实现是由一系列特殊编码的连续内存块组成的顺序型的数据结构在列表头有三个字段和列表中有多个表尾还有一个我们来具体拆解下表示列表占用字节数列表尾的偏移量列表尾的偏移量列表中的个数存储区可以包含多个节点每个节点可以存放整数或者字符串表示列表结束参考代码如下列表占用字节数列表尾的偏移量用于快速定位到最后一个节点列表元素个数元素内容列表标志压缩列表的结束值恒为如果查找定位首个元素或最后个元素可以通过表头元素快速获取复杂度是但是查找其他元素时就没有这么高效了只能逐个查找下去比如的复杂度就是双端列表数据类型经常使用在链表消息队列栈有序的对象列表如朋友圈的点赞顺序列表评论顺序列表关注时间线等场景无论是队列先进先出还是栈先进后出双端列表都能很好的支持参考代码如下表头表尾链表所包含的节点数量函数复制节点值函数释放节点值函数对比节点值的链表实现的特性可以总结如下双端链表节点带有和指针获取某个节点的前一节点和后一节点的复杂度都是无环表头节点的指针和表尾节点的指针都指向对链表的访问以为终点表头指针表尾指针通过结构的指针和指针获取链表的表头节点和表尾节点的复杂度为链表长度计数器通过结构的属性来对的链表节点进行计数获取节点数量的复杂度为多态链表节点使用指针来保存节点值并通过结构的三个属性为节点值设置类型特定函数所以链表可以用于保存各种不同类型的值使用链表的附加空间相对太高因为系统中指针是个字节所以和指针需要占据个字节且链表节点在内存中单独分配会加剧内存的碎片化影响内存管理效率考虑到链表的以上缺点后续版本对列表数据结构进行改造使用代替了和作为和的混合体它将按段切分每一段使用来紧凑存储多个之间使用双向指针串接起来这样性能就的得到了更大的提升字典无论何种类型都是以一个结构的形式来保存键值对的整体是一个数组数组中的每个元素都是一个独立的对象被称为哈系桶比如图中对应的保存着实际具体值的指针上图中的全局哈希表它的时间复杂度是只需要计算每个键的哈希值便知道对应的哈希桶位置定位桶中的并找到对应数据这个执行效率就很高了为了解决可能存在的冲突采用了链式哈希的做法也就是同一个桶里面的元素使用链表保存整数集合如果你的集合只有整数值元素并且数量是轻量的这时候会使用使用整数集合作为集合的底层数据结构参考如下代码编码格式集合中的元素个数保存元素数据我们拆解下编码方式数组中元素个数也就是数组的整体长度整数集合集合的每个元素都是数组的一个数组项具有以下特点按值的大小增序排列不包含任何重复项跳跃表即跳跃表是一种有序数据结构所以它也是数据类型中的一种通过在每个节点中维持多个指向其他节点的指针达到快速定位的目标跳跃表的平均的节点搜索平均时间复杂度是最差时间复杂度是还可以通过顺序性操作来批量处理节点跳跃表是基于链表的改良在它基础上增加了多层级索引通过索引不断跳转最终定好位到真实的数据项这个方式是不是让大家想到理念上有点接近如下图所示可以看出需要获取这个元素需要经历次查找需要获取则需要经历次查找单线程模型的单线程主要是指的网络和键值对读写是由一个线程来完成的在处理客户端的请求时包括获取读解析执行内容返回写等都由一个顺序串行的主线程处理这就是所谓的单线程这也是对外提供键值存储服务的主要流程但的其他功能比如持久化异步删除集群数据同步等等其实是由额外的线程执行的可以这么说工作线程是单线程的但是整个来说是多线程的为何是单线程那在主流程中使用单线程主要是出于什么原因呢整体吞吐量降低适当的扩增线程是为了有效的利用的性能让它跟内存达到一个利用的最优值但频繁的读写如果没有对线程进行有效管理不但对系统的吞吐量没有提升反而可能导致下降上下文切换在运行任务的时候需要把任务加载到寄存器中进行计算当切换到其他时需要将当前上下文存储在系统内核中以便后续重新执行计算时再次加载就像你做专心做一件事时频繁切换频繁被打断这个代价是非常高的如图中切换上下文时我们需要完成一系列工作等这种操作越频繁越是耗费资源共享资源的并发控制问题引入了程序执行顺序的不确定性带来了并发读写的一系列问题增加了系统复杂度同时可能存在线程切换甚至加锁解锁死锁造成的性能损耗内存才是核心关注点对于框架来说主要的性能瓶颈是内存或者网络带宽而非单线程的好处避免线程创建过多导致的性能消耗反而降低整体吞吐能力避免上下文切换引起的额外的开销避免了线程之间的竞争问题如加锁解锁死锁等都会造成性能损耗无需额外考虑多线程带来的程序复杂度代码更清晰处理逻辑简单单线程是否有效利用官方这么说大概意思是是完全的纯内存操作执行速度是非常快的通常不会是瓶颈因为大多数请求不会是密集型的参考真正的性能瓶颈在网络也就是客户端和服务端之间的网络传输延迟因此选择了单线程的多路复用来实现它的核心网络模型多路复用模型服务端网络编程常见的模型有四种同步阻塞同步非阻塞多路复用异步采用的是多路复用技术并发的去处理连接它的多路复用程序函数有以目前最新的也是最好的多路复用技术函数为例当客服端执行等操作命令时它会将命令封装成一个个事件然后利用多路复用的特性来避免阻塞下面我们看看普通模型和的多路复模型的的区别来分析高频请求下如何保持高效执行普通模型先来看一下传统的阻塞模型到底是如何工作的当使用或者对某一个文件描述符进行读写时如果当前不可读或不可写整个服务就不会对其它的操作作出响应导致整个服务不可用这也就是传统意义上的也就是我们在编程中使用最多的阻塞模型阻塞模型虽然开发中非常常见也非常易于理解但是由于它会影响其他对应的服务所以在需要处理多个客户端任务的时候往往都不会使用阻塞模型多路复用多路复用指的是多个连接复用一个线程这种模式下内核不会去监视应用程序的连接而是监视文件描述符当客户端发起请求的时候会生成不同事件类型的套接字而在服务端因为使用了多路复用技术所以不是阻塞式的同步执行而是将消息放入队列参考下图的然后通过将其转发到不同的事件处理器上如综上我们得出如下特性单线程模式内核持续监听上的连接及数据请求一监听就交予线程处理达到单个线程处理多个流的效果提供了基于事件的回调机制不同事件调用对应的事件处理器可以持续性的高效处理事件性能同步提升不阻塞任一客户端发起的请求所以可以同时和多个客户端连接并处理请求聚币并发执行的能力高性能总结基于内存实现而非磁盘大都是简单的存取操作资源主要消耗在上所以读取速度快数据结构基于不同业务场景的高效数据结构动态字符串整数字符串双端列表压缩列表跳跃表哈希表整数集合线程模型的网络以及键值对指令读写是由单个线程来执行的避免了不必要的和竞选模型基于多路复用模型非阻塞的模型恰单的数据编码根据实际数据类型选择合理的数据编码本身是一个全局哈希表他的时间复杂度是另外为了防止哈希冲突导致链表过长执行操作进行扩充减少哈希冲突',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-03-11 21:18:24',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#1F1F1F')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#F9F9F9')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网站项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://imags-563.pages.dev" title="个人博客"><img class="back-menu-item-icon" src="/favicon.ico" alt="个人博客"/><span class="back-menu-item-text">个人博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://imags-563.pages.dev" title="在线简历"><img class="back-menu-item-icon" src="/favicon.ico" alt="在线简历"/><span class="back-menu-item-text">在线简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">建设工具</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://imags-563.pages.dev" title="在线图床"><img class="back-menu-item-icon" src="/img/image.ico" alt="在线图床"/><span class="back-menu-item-text">在线图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://greatree.hidns.co" title="在线烟花模拟器"><img class="back-menu-item-icon" src="/img/Clash.Mini.png" alt="在线烟花模拟器"/><span class="back-menu-item-text">在线烟花模拟器</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://greatree.hidns.co" title="烟花模拟器"><img class="back-menu-item-icon" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMMZ7Qfv1Xv2qvgqSVN7kNhRO_uzfgAAlvAMRtiZKBVrGT1Z6RPiX4BAAMCAANtAAM2BA.png" alt="烟花模拟器"/><span class="back-menu-item-text">烟花模拟器</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://pay.totalh.net/" title="三合一收款码"><img class="back-menu-item-icon" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAM8Z7WNYNdWdrYsas5PPFT8Di3493sAAgLKMRsEtalVDcfaakgTXPkBAAMCAAN4AAM2BA.png" alt="三合一收款码"/><span class="back-menu-item-text">三合一收款码</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">数根朽木，</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 博客文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 全部文章</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 所有标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 网站工具</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://imags-563.pages.dev"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 图床工具</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://greatree.hidns.co"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 烟花模拟器</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://suburl.v1.mk"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 订阅转换</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://imags-563.pages.dev"><span> 在线简历生成</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于我</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://imags-563.pages.dev"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 在线简历</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMEZ7HheDSuPHt4eDeH2L1Y4ORfslsAArXEMRuvMJFVZbGWT1spGtgBAAMCAAN4AAM2BA.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMEZ7HheDSuPHt4eDeH2L1Y4ORfslsAArXEMRuvMJFVZbGWT1spGtgBAAMCAAN4AAM2BA.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMFZ7Hh6gSTlGPMvEOEIQjcnW85WsUAArfEMRuvMJFV1ctnAAFzfhv0AQADAgADeAADNgQ.jpg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMFZ7Hh6gSTlGPMvEOEIQjcnW85WsUAArfEMRuvMJFV1ctnAAFzfhv0AQADAgADeAADNgQ.jpg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Boolean-filter/" style="font-size: 1.05rem;">Boolean filter<sup>2</sup></a><a href="/tags/DNS%E6%B3%84%E9%9C%B2/" style="font-size: 1.05rem;">DNS泄露<sup>1</sup></a><a href="/tags/Fake-IP/" style="font-size: 1.05rem;">Fake IP<sup>1</sup></a><a href="/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 1.05rem;">JVM虚拟机<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>1</sup></a><a href="/tags/JavaSE/" style="font-size: 1.05rem;">JavaSE<sup>11</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 1.05rem;">Java基础<sup>11</sup></a><a href="/tags/Java%E6%A0%B8%E5%BF%83/" style="font-size: 1.05rem;">Java核心<sup>14</sup></a><a href="/tags/Java%E7%89%88%E6%9C%AC%E6%96%B0%E7%89%B9%E6%80%A7/" style="font-size: 1.05rem;">Java版本新特性<sup>2</sup></a><a href="/tags/MQ/" style="font-size: 1.05rem;">MQ<sup>2</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem;">MySQL<sup>10</sup></a><a href="/tags/OOM/" style="font-size: 1.05rem;">OOM<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size: 1.05rem;">RabbitMQ<sup>2</sup></a><a href="/tags/Redis/" style="font-size: 1.05rem;">Redis<sup>5</sup></a><a href="/tags/Redis%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" style="font-size: 1.05rem;">Redis内存淘汰策略<sup>1</sup></a><a href="/tags/Redis%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">Redis原理<sup>1</sup></a><a href="/tags/Redis%E7%BC%93%E5%AD%98/" style="font-size: 1.05rem;">Redis缓存<sup>1</sup></a><a href="/tags/RocketMQ/" style="font-size: 1.05rem;">RocketMQ<sup>2</sup></a><a href="/tags/SSM/" style="font-size: 1.05rem;">SSM<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>1</sup></a><a href="/tags/SpringBoot/" style="font-size: 1.05rem;">SpringBoot<sup>1</sup></a><a href="/tags/kafka/" style="font-size: 1.05rem;">kafka<sup>2</sup></a><a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">单例模式<sup>1</sup></a><a href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" style="font-size: 1.05rem;">布隆过滤器<sup>2</sup></a><a href="/tags/%E6%8E%A5%E5%8F%A3%E8%B6%85%E6%97%B6/" style="font-size: 1.05rem;">接口超时<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">消息中间件<sup>2</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 1.05rem;">消息队列<sup>1</sup></a><a href="/tags/%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85/" style="font-size: 1.05rem;">线上事故<sup>1</sup></a><a href="/tags/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9/" style="font-size: 1.05rem;">缓存雪崩<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96/" style="font-size: 1.05rem;">网络优化<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4%E8%B0%83%E4%BC%98/" style="font-size: 1.05rem;">运维调优<sup>3</sup></a><a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">高并发<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Redis%E7%B3%BB%E5%88%97/" itemprop="url">Redis系列</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Redis/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Redis</span></a><a class="article-meta__tags" href="/tags/Redis%E5%8E%9F%E7%90%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Redis原理</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Redis系列1：深刻理解高性能Redis的本质</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-11T13:18:24.000Z" title="发表于 2025-03-11 21:18:24">2025-03-11</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-03-11T13:18:24.000Z" title="更新于 2025-03-11 21:18:24">2025-03-11</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为深圳"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>深圳</span></div></div></div><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANsaUJahYhmpT20C3buqSiwwIky_9gAAp8LaxvvjBBWtjzhzL6BcHEBAAMCAAN3AAM2BA.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/"><header><a class="post-meta-categories" href="/categories/Redis%E7%B3%BB%E5%88%97/" itemprop="url">Redis系列</a><a href="/tags/Redis/" tabindex="-1" itemprop="url">Redis</a><a href="/tags/Redis%E5%8E%9F%E7%90%86/" tabindex="-1" itemprop="url">Redis原理</a><h1 id="CrawlerTitle" itemprop="name headline">Redis系列1：深刻理解高性能Redis的本质</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">dachang</span><time itemprop="dateCreated datePublished" datetime="2025-03-11T13:18:24.000Z" title="发表于 2025-03-11 21:18:24">2025-03-11</time><time itemprop="dateCreated datePublished" datetime="2025-03-11T13:18:24.000Z" title="更新于 2025-03-11 21:18:24">2025-03-11</time></header><h1 id="1-背景"><a href="#1-背景" class="headerlink" title="1 背景"></a>1 背景</h1><p>分布式系统绕不开的核心之一的就是数据缓存，有了缓存的支撑，系统的整体吞吐量会有很大的提升。通过使用缓存，我们把频繁查询的数据由磁盘调度到缓存中，保证数据的高效率读写。当然，除了在内存内运行还远远不够，我们今天就以具有代表性的缓存中间件Redis为例子，分析下，它是如何达到飞起的效率。</p>
<h1 id="2-Redis高效性能分析"><a href="#2-Redis高效性能分析" class="headerlink" title="2 Redis高效性能分析"></a>2 Redis高效性能分析</h1><p>Redis之所以能够提供超高的执行效率，主要从以下几个维度来实现的：<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANsaUJahYhmpT20C3buqSiwwIky_9gAAp8LaxvvjBBWtjzhzL6BcHEBAAMCAAN3AAM2BA.png"></p>
<ul>
<li>存储模式：基于内存实现，而非磁盘</li>
<li>数据结构：基于不同业务场景的高效数据结构<ul>
<li>动态字符串(REDIS_STRING)：整数(REDIS_ENCODING_INT)、字符串(REDIS_ENCODING_RAW)</li>
<li>双端列表(REDIS_ENCODING_LINKEDLIST)</li>
<li>压缩列表(REDIS_ENCODING_ZIPLIST)</li>
<li>跳跃表(REDIS_ENCODING_SKIPLIST)</li>
<li>哈希表(REDIS_HASH)</li>
<li>整数集合(REDIS_ENCODING_INTSET)</li>
</ul>
</li>
<li>线程模型： Redis 的网络 IO 以及键值对指令读写是由单个线程来执行的，避免了不必要的contextswitch和竞选</li>
<li>I&#x2F;O 模型： 基于I&#x2F;O多路复用模型，非阻塞的I&#x2F;O模型</li>
<li>恰单的数据编码： 根据实际数据类型，选择合理的数据编码</li>
</ul>
<h2 id="2-1-官网的性能报告"><a href="#2-1-官网的性能报告" class="headerlink" title="2.1 官网的性能报告"></a>2.1 官网的性能报告</h2><p>Redis官方站点中，有对Redis性能做了比较详细的压测，可以参考官方这一篇 <a target="_blank" rel="noopener" href="https://redis.io/topics/benchmarks">How fast is Redis?</a>，在较高的配置基准下（比如 8C 16G +），在连接数为0~10000的时候，最高QPS可达到120000。Redis以超过60000个连接为基准，仍然能够在这些条件下维持50000个q&#x2F;s，体现了超高的性能。下图中横轴是连接数，纵轴是QPS。<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANuaUJb7Bn3HC0puG7nJ2BTm9ozbmoAAqILaxvvjBBWUInBLUSpaxABAAMCAAN4AAM2BA.png"><br>下面这张图为data size 与整体吞吐量之间的趋向关系：<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANvaUJcBElaWK_iQhxNzRukOozjSfQAAqMLaxvvjBBWJf_W3gABf_3QAQADAgADeAADNgQ.png"></p>
<p>这个大概可以得出一个容量预估，比如你的服务用户量是多少，预估峰值QPS是多少，集群需要配置多少个实例（虽然实例的多少不能线性计算），可以大致推算出去。</p>
<h2 id="2-2-基于内存实现"><a href="#2-2-基于内存实现" class="headerlink" title="2.2 基于内存实现"></a>2.2 基于内存实现</h2><p>Redis的读写操作都是在内存中实现了，相对其他的持久化存储（如MySQL、File等，数据持久化在磁盘上），性能会高很多。因为在们在操作数据的时候，需要通过 IO 操作先将数据读取到内存里，增加工作成本。</p>
<p><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANwaUJcOIFjj2RpeyYEPEnUuhbS8iwAAqQLaxvvjBBWXIlT7ND9TucBAAMCAAN5AAM2BA.png"></p>
<p>上面那张图来源于网络，可以看看他的金字塔模型，越往上执行效率越高，价格也就越贵。下面给出每一层的执行耗时对比：</p>
<ul>
<li>寄存器：0.3 ns</li>
<li>L1高速缓存：0.9 ns</li>
<li>L2高速缓存：2.8 ns</li>
<li>L3高速缓存：12.9 ns</li>
<li>主存：120 ns</li>
<li>本地二级存储（SSD）：50~150 us</li>
<li>远程二级存储：30 ms<br>这样可能不直观，我们举个L1和SSD的对比，如果L1耗时1s的话，SSD中差不多要15~45小时。<br>因为 CPU 内部集成了内存控制器，所以CPU直接控制了内存，给予通信上的最优带宽。上面的部分数据引用自《<a target="_blank" rel="noopener" href="http://product.dangdang.com/23762087.html">性能之巅：洞悉系统、企业与云计算</a>》。</li>
</ul>
<h2 id="2-3-适配多元场景的高效数据结构"><a href="#2-3-适配多元场景的高效数据结构" class="headerlink" title="2.3 适配多元场景的高效数据结构"></a>2.3 适配多元场景的高效数据结构</h2><p>在 Redis 缓存中，常用的主要数据类型有五种，如下：</p>
<ul>
<li>字符串&#x2F;REDIS_STRING：适用于 缓存、计数、共享Session、IP统计、分布式锁等。</li>
<li>列表&#x2F;REDIS_LIST： 链表、消息队列、栈、有序的对象列表（如朋友圈的点赞顺序列表、评论顺序列表）。</li>
<li>哈希表&#x2F;REDIS_HASH： 购物车信息、用户信息、Hash类型的(key, field, value)存储对象等。</li>
<li>集合&#x2F;REDIS_SET：无序的唯一的键值结构： 好友、关注、粉丝、感兴趣的人集合等。</li>
<li>有序集合&#x2F;REDIS_ZSET：访问排行榜、点赞排行、粉丝数排行等。</li>
</ul>
<p>上面这5种Redis 支持的数据类型，能够满足不同业务场景下的数据结构需求。而对于这几类数据类型的区分和支持，目的无非也是为了效率，具体的业务中使用恰当的数据结构才能保证得到应有的效率。</p>
<p>这5种数据类型都有一种或者多种数据结构来支撑，底层数据结构有 7 种。关系如下：<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAOhaUYTlCGnYtTmCbYAAR_OQK4XZAotAAJgC2sb0X4wVgvpselcoIZgAQADAgADdwADNgQ.png"><br>	下面我们对这些数据结构一个个的分析。</p>
<h3 id="2-3-1-SDS-简单动态字符串"><a href="#2-3-1-SDS-简单动态字符串" class="headerlink" title="2.3.1 SDS 简单动态字符串"></a>2.3.1 SDS 简单动态字符串</h3><p>Redis使用简单动态字符串（simple dynamic string，SDS）来表示字符串，Redis中字符串类型包含的数据结构有：整数（R_INT） 、 字符串（R_RAW）。我们以字符串为例子，常规的字符串，如 “Brand”，如果要获取他的长度，需要从头开始遍历，直至遇到 \0 空字符代表结尾,如 C字符串。</p>
<p>C 字符串结构与 SDS 字符串结构 对比图 参照如下：<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAOiaUYTo38cOQ2RuhvRXvu5l0ZoXEsAAmELaxvRfjBW7KzW_lIkKqkBAAMCAAN5AAM2BA.png"></p>
<ul>
<li>free属性的值为0，表示这个SDS没有分配任何未使用空间。</li>
<li>len属性的值为5，表示这个SDS保存了一个5字节长度的字符串。</li>
<li>buf是一个char类型的数组，存储真实的字符串，数组的前五个字节分别保存了’B’、’r’、’a’、’n’、’d’五个字符，而最后一个字节则保存了空字符’\0’，代表结尾。<br>注意：SDS遵循C字符串的惯例以空字符结尾，保存空字符的1字节不计算在SDS的len属性中。</li>
</ul>
<p>比起C字符串，SDS具有以下优点：</p>
<ol>
<li><p>度获取字符串长度时间复杂度为O(1) 。C字符串不记录自身长度，获取C字符串长度时必须遍历整个字符串计数得到，复杂度是O(N)SDS字符串自身记录维护len长度属性，获得SDS字符串长度的复杂度是O(1)</p>
</li>
<li><p>杜绝缓冲区溢出。C字符串不记录长度，由于两个C字符串在内存存储上紧邻，在执行字符串拼接strcat时，如果不提前分配足够空间，很可能发生修改s1的数据溢出到s2所在的空间中（缓冲区溢出）。SDS杜绝了缓冲区溢出问题，它记录了长度，当修改SDS字符串之前，API都会检查SDS的空间是否满足修改的要求，不满足API会自动进行空间扩展。</p>
</li>
<li><p>空间预分配，减少修改时的内存重分配次数SDS 被修改后，程序不仅会为 SDS 分配所需要的空间，还会分配额外的未使用空间。这样，Redis可以减少连续执行字符串增长操作所需的内存重分配次数。具体分配未使用空间如下2种方式：</p>
<ul>
<li><p>如修改后长度len小于1MB，就分配和len属性相同大小的未使用空间：free&#x3D;len。</p>
</li>
<li><p>如修改后长度len大于等于1MB，就分配1M的未使用空间：free&#x3D;1MB。</p>
</li>
</ul>
</li>
<li><p>惰性空间释放，缩短操作时：SDS避免了缩短字符串时所需的内存重分配操作，并为将来可能有的增长操作提供了优化。当SDS做缩短操作，不会立刻使用内存重分配来收回缩短后多出来的字节，而是保持在free属性里。将来如果需要 append 操作，则直接使用 free 中未使用的空间，减少了内存的分配步骤。另外，SDS也提供了API手动进行释放SDS未使用空间，避免惰性释放策略会造成内存浪费。</p>
</li>
<li><p>二进制安全，C字符串的字符必须符合某种编码，除结尾空字符以外，字符串内部不允许有空字符串，存储有局限性。而在 Redis 中，不仅可以存储 String 类型的数据，也可能存储一些二进制数据。二进制数据并不是规则的字符串格式，其中会包含一些特殊的字符如 ‘\0’。在 C 中遇到 ‘\0’ 则表示字符串的结束，但SDS不是，它是以len长度标识结尾。</p>
</li>
<li><p>兼容部分C字符串函数。SDS虽然是二进制安全的，但还是秉承C字符串以空字符结尾的特性，很多函数与C字符串一致不需要重写。</p>
</li>
</ol>
<h3 id="2-3-2-zipList-压缩列表"><a href="#2-3-2-zipList-压缩列表" class="headerlink" title="2.3.2 zipList 压缩列表"></a>2.3.2 zipList 压缩列表</h3><p>通过上面的数据结构关系图，可以看出，压缩列表是 List 、Hash、 Set 三种数据类型底层实现之一。当我们的list列表数据量比较少的时候，且存储的数据轻量的（如小整数值、短字符串）时候， Redis 就会通过压缩列表来进行底层实现。ziplist 是由一系列特殊编码的连续内存块组成的顺序型的数据结构，在列表头有三个字段 zlbytes、zltail 和 zllen，列表中有多个entry，表尾还有一个 zlend，我们来具体拆解下：</p>
<ul>
<li>zlbytes：表示列表占用字节数</li>
<li>zltail：列表尾的偏移量</li>
<li>zllen：列表尾的偏移量：列表中的 entry 个数</li>
<li>entry：存储区，可以包含多个节点，每个节点可以存放整数或者字符串。</li>
<li>zlend：表示列表结束。</li>
</ul>
<p>参考代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ziplist</span>&lt;</span>T&gt; &#123;</span><br><span class="line">    <span class="comment">// 列表占用字节数</span></span><br><span class="line">    int32 zlbytes;</span><br><span class="line">	<span class="comment">// 列表尾的偏移量，用于快速定位到最后一个节点</span></span><br><span class="line">    int32 zltail_offset; </span><br><span class="line">	<span class="comment">// 列表entry元素个数</span></span><br><span class="line">    int16 zllength; </span><br><span class="line">	<span class="comment">// 元素内容列表</span></span><br><span class="line">    T[] entries; </span><br><span class="line">	<span class="comment">// 标志压缩列表的结束，值恒为 0xFF</span></span><br><span class="line">    int8 zlend; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANxaUJdHsQpTQHDHm_jOJ3EBl3NbCsAAqULaxvvjBBWqf_yqAMxBjgBAAMCAAN4AAM2BA.png"><br>如果查找定位首个元素或最后1个元素，可以通过表头zlbytes、zltail_offset元素快速获取，复杂度是 O(1)。但是查找其他元素时，就没有这么高效了，只能逐个查找下去，比如 entry n 的复杂度就是 O(N)。</p>
<h3 id="2-3-3-linklist-双端列表"><a href="#2-3-3-linklist-双端列表" class="headerlink" title="2.3.3 linklist 双端列表"></a>2.3.3 linklist 双端列表</h3><p>Redis List 数据类型经常使用在链表、消息队列、栈、有序的对象列表（如朋友圈的点赞顺序列表、评论顺序列表、关注时间线）等场景，无论是队列（先进先出），还是栈（先进后出），双端列表都能很好的支持。<br>参考代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> list &#123;</span><br><span class="line">	<span class="comment">// 表头</span></span><br><span class="line">	listnode * head;</span><br><span class="line">	<span class="comment">// 表尾</span></span><br><span class="line">	listnode * tail;</span><br><span class="line">	<span class="comment">// 链表所包含的节点数量</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> len;</span><br><span class="line">	<span class="comment">// 函数：复制节点值</span></span><br><span class="line">	<span class="type">void</span> *(*dup)(<span class="type">void</span> *ptr);</span><br><span class="line">	<span class="comment">// 函数：释放节点值</span></span><br><span class="line">	<span class="type">void</span> (*free)(<span class="type">void</span> *ptr);</span><br><span class="line">	<span class="comment">// 函数：对比节点值</span></span><br><span class="line">	<span class="type">int</span> (*match)(<span class="type">void</span> *ptr, <span class="type">void</span> *key);</span><br><span class="line">&#125; list;</span><br></pre></td></tr></table></figure>

<p>Redis 的链表实现的特性可以总结如下：</p>
<ul>
<li>双端：链表节点带有 prev 和 next 指针，获取某个节点的前一节点和后一节点的复杂度都是 O(1)。</li>
<li>无环：表头节点的 prev 指针和表尾节点的 next 指针都指向 NULL，对链表的访问以 NULL 为终点。</li>
<li>表头指针&#x2F;表尾指针：通过 list 结构的 head 指针和 tail 指针，获取链表的表头节点和表尾节点的复杂度为 O(1)。</li>
<li>链表长度计数器：通过 list 结构的 len 属性来对 list 的链表节点进行计数，获取节点数量的复杂度为O(1)。</li>
<li>多态：链表节点使用 void* 指针来保存节点值，并通过 list 结构的 dup、free、match 三个属性为节点值设置类型特定函数，所以链表可以用于保存各种不同类型的值。使用链表的附加空间相对太高，因为64bit系统中指针是8个字节，所以prev和next指针需要占据16个字节，且链表节点在内存中单独分配，会加剧内存的碎片化，影响内存管理效率。考虑到链表的以上缺点，Redis后续版本对列表数据结构进行改造，使用quicklist代替了ziplist和linkedlist。 作为ziplist 和 linkedlist 的混合体，它将 linkedlist 按段切分，每一段使用 ziplist 来紧凑存储，多个 ziplist 之间使用双向指针串接起来。<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANyaUJdORu2Z5dHjG1QnGd8DVTNJGsAAqYLaxvvjBBWOCIIpvFHep0BAAMCAAN5AAM2BA.png"><br>这样，性能就的得到了更大的提升。</li>
</ul>
<h3 id="2-3-4-Hhash-字典"><a href="#2-3-4-Hhash-字典" class="headerlink" title="2.3.4 Hhash 字典"></a>2.3.4 Hhash 字典</h3><p>无论何种类型（string、list、hash、set、zset），Redis都是以一个Hash结构的形式来保存键值对的。整体是一个数组，数组中的每个元素都是一个独立的对象，被称为哈系桶，比如图中1 ~ n, 对应的entry保存着实际具体值的指针。<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN0aUJdhO9sSstRoX1-wSq4wEzi4mIAAqcLaxvvjBBWOphPTIesHloBAAMCAAN3AAM2BA.png"><br>		上图中的全局哈希表，它的时间复杂度是 O(1)，只需要计算每个键的哈希值，便知道对应的哈希桶位置，定位桶中的 entry ，并找到对应数据。这个执行效率就很高了。为了解决可能存在的冲突，采用了链式哈希的做法，也就是同一个桶里面的元素使用链表保存。</p>
<h3 id="2-3-5-intset-整数集合"><a href="#2-3-5-intset-整数集合" class="headerlink" title="2.3.5 intset 整数集合"></a>2.3.5 intset 整数集合</h3><p>如果你的集合只有整数值元素，并且数量是轻量的，这时候Redis会使用使用整数集合作为Redis集合的底层数据结构。参考如下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">intset</span>&#123;</span><br><span class="line">     <span class="comment">// 编码格式</span></span><br><span class="line">     <span class="type">uint32_t</span> encoding;</span><br><span class="line">     <span class="comment">// 集合中的元素个数</span></span><br><span class="line">     <span class="type">uint32_t</span> length;</span><br><span class="line">     <span class="comment">// 保存元素数据</span></span><br><span class="line">     <span class="type">int8_t</span> contents[];</span><br><span class="line">&#125; intset;</span><br></pre></td></tr></table></figure>

<p>我们拆解下：</p>
<ul>
<li><p><strong>encoding：</strong> 编码方式</p>
</li>
<li><p><strong>length：</strong> 数组中元素个数，也就是数组的整体长度</p>
</li>
<li><p><strong>contents</strong>[]：</p>
<p>整数集合，集合的每个元素都是数组的一个数组项（item）。具有以下特点：</p>
<ul>
<li>按值的大小增序排列</li>
<li>不包含任何重复项</li>
</ul>
</li>
</ul>
<h3 id="2-3-6-skipList跳跃表"><a href="#2-3-6-skipList跳跃表" class="headerlink" title="2.3.6 skipList跳跃表"></a>2.3.6 skipList跳跃表</h3><p>skiplist（即跳跃表）是一种有序数据结构，所以它也是ZSet数据类型中的一种，通过在每个节点中维持多个指向其他节点的指针，达到快速定位的目标。</p>
<p>跳跃表的平均的节点搜索，平均时间复杂度是 O(logN)、最差时间复杂度是 O(N)，还可以通过顺序性操作来批量处理节点。 跳跃表是基于链表的改良，在它基础上，增加了多层级索引，通过索引不断跳转，最终定好位到真实的数据项。这个方式是不是让大家想到b+tree，理念上有点接近，如下图所示：<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN1aUJdtoyIZpPiLTEfnthBwv0PpH8AAqgLaxvvjBBW7NxZ_1Lb91UBAAMCAAN5AAM2BA.png"><br>可以看出，需要获取 68 这个元素需要经历3次查找，需要获取 97则需要经历4次查找。</p>
<h2 id="2-4-单线程模型"><a href="#2-4-单线程模型" class="headerlink" title="2.4 单线程模型"></a>2.4 单线程模型</h2><p><strong>Redis 的单线程主要是指Redis的网络IO和键值对读写是由一个线程来完成的，Redis在处理客户端的请求时包括获取 (socket 读)、解析、执行、内容返回 (socket 写) 等都由一个顺序串行的主线程处理，这就是所谓的“单线程”。这也是Redis对外提供键值存储服务的主要流程。</strong></p>
<p>但Redis的其他功能， 比如持久化、异步删除、集群数据同步等等，其实是由额外的线程执行的。 可以这么说，Redis工作线程是单线程的。但是，整个Redis来说，是多线程的。</p>
<h3 id="2-4-1-为何是单线程？"><a href="#2-4-1-为何是单线程？" class="headerlink" title="2.4.1 为何是单线程？"></a>2.4.1 为何是单线程？</h3><p>那在主流程中使用单线程，主要是出于什么原因呢？</p>
<ul>
<li><strong>整体吞吐量降低</strong><br>适当的扩增线程，是为了有效的利用cpu的性能，让它跟内存达到一个利用的最优值。但频繁的Redis读写，如果没有对线程进行有效管理，不但对系统的吞吐量没有提升，反而可能导致下降。<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN2aUJd2pA6an-IpSvAE_RXCSA7IpsAAqwLaxvvjBBWfYIom8xRJ6IBAAMCAAN4AAM2BA.png"></li>
<li><strong>CPU上下文切换</strong><br>在运行任务的时候，CPU需要把任务加载到CPU寄存器中进行计算，当切换到其他thread时，需要将当前上下文存储在系统内核中，以便后续重新执行计算时再次加载。就像你做专心做一件事时，频繁切换，频繁被打断，这个代价是非常高的。<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN3aUJd5ZJEBMoeY0Ewzn3p5w3WoxQAAq0LaxvvjBBWviQxgPH9LdIBAAMCAAN4AAM2BA.png"><br>如图中，切换上下文时，我们需要完成一系列工作，save context、switch、restore context等，这种操作越频繁越是耗费资源。</li>
<li><strong>共享资源的并发控制问题</strong><br>引入了程序执行顺序的不确定性，带来了并发读写的一系列问题，增加了系统复杂度。同时可能存在线程切换、甚至加锁解锁、死锁造成的性能损耗。</li>
<li><strong>内存才是核心关注点</strong><br>对于 Redis 框架来说， 主要的性能瓶颈是内存或者网络带宽，而非 CPU。</li>
</ul>
<h3 id="2-4-2-单线程的好处"><a href="#2-4-2-单线程的好处" class="headerlink" title="2.4.2 单线程的好处"></a>2.4.2 单线程的好处</h3><ol>
<li>避免线程创建过多导致的性能消耗，反而降低整体吞吐能力。</li>
<li>避免上下文切换引起的 CPU 额外的开销。</li>
<li>避免了线程之间的竞争问题，如加锁、解锁、死锁等，都会造成性能损耗。</li>
<li>无需额外考虑多线程带来的程序复杂度，代码更清晰，处理逻辑简单。</li>
</ol>
<h3 id="2-4-3-单线程是否有效利用CPU"><a href="#2-4-3-单线程是否有效利用CPU" class="headerlink" title="2.4.3 单线程是否有效利用CPU"></a>2.4.3 单线程是否有效利用CPU</h3><p>官方这么说</p>
<blockquote>
<p>It’s not very frequent that CPU becomes your bottleneck with Redis, as usually Redis is either memory or network bound. For instance, using pipelining Redis running on an average Linux system can deliver even 1 million requests per second, so if your application mainly uses O(N) or O(log(N)) commands, it is hardly going to use too much CPU.</p>
</blockquote>
<p>大概意思是，Redis是完全的纯内存操作，执行速度是非常快的，CPU通常不会是瓶颈，因为大多数请求不会是CPU密集型的。<a target="_blank" rel="noopener" href="https://redis.io/docs/getting-started/faq/">参考</a>，Redis真正的性能瓶颈在网络IO，也就是客户端和服务端之间的网络传输延迟，因此Redis选择了单线程的IO多路复用来实现它的核心网络模型。</p>
<h2 id="2-5-I-O-多路复用模型"><a href="#2-5-I-O-多路复用模型" class="headerlink" title="2.5 I&#x2F;O 多路复用模型"></a>2.5 I&#x2F;O 多路复用模型</h2><p>服务端网络编程常见的 I&#x2F;O 模型有四种：同步阻塞IO（Blocking IO）、同步非阻塞IO（Non-blocking IO）、IO多路复用（IO Multiplexing）、异步IO（Asynchronous IO）。</p>
<p>Redis 采用的是 I&#x2F;O 多路复用技术，并发的去处理连接，它的多路复用程序函数有 select、poll、epoll、kqueue。以 epoll （目前最新的也是最好的多路复用技术）函数为例，当客服端执行 read、write、accept、close 等操作命令时，它会将命令封装成一个个事件，然后利用 epoll 多路复用的特性来避免 I&#x2F;O 阻塞。</p>
<p>下面我们看看普通 I&#x2F;O 模型 和 Redis的 I&#x2F;O 多路复模型的的区别，来分析Redis高频请求下如何保持高效执行。</p>
<h3 id="2-5-1-普通-I-O-模型"><a href="#2-5-1-普通-I-O-模型" class="headerlink" title="2.5.1 普通 I&#x2F;O 模型"></a>2.5.1 普通 I&#x2F;O 模型</h3><p>先来看一下传统的阻塞 I&#x2F;O 模型到底是如何工作的：当使用 read 或者 write 对某一个文件描述符（File Descriptor：FD)进行读写时，如果当前 FD 不可读或不可写，整个 Redis 服务就不会对其它的操作作出响应，导致整个服务不可用。</p>
<p>这也就是传统意义上的，也就是我们在编程中使用最多的阻塞模型：<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN4aUJeEhrgpcra_YyBw2UE9X7lgOEAAq4LaxvvjBBWXAQx6qsoQQUBAAMCAAN5AAM2BA.png"><br>		阻塞模型虽然开发中非常常见也非常易于理解，但是由于它会影响其他 FD 对应的服务，所以在需要处理多个客户端任务的时候，往往都不会使用阻塞模型。</p>
<h3 id="2-5-2-I-O-多路复用"><a href="#2-5-2-I-O-多路复用" class="headerlink" title="2.5.2 I&#x2F;O 多路复用"></a>2.5.2 I&#x2F;O 多路复用</h3><p><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN5aUJeNM-4Qy4_DSMvUuDND5uRxyUAArALaxvvjBBW0dgCHSXOrvABAAMCAAN5AAM2BA.png"><br><strong>多路复用</strong>指的是：多个socket连接复用一个线程。这种模式下，内核不会去监视应用程序的连接，而是监视文件描述符.</p>
<p>当客户端发起请求的时候，会生成不同事件类型的套接字。而在服务端，因为使用了 I&#x2F;O 多路复用技术，所以不是阻塞式的同步执行，而是将消息放入 socket 队列（参考下图的 I&#x2F;O Multiplexing module），然后通过 File event Dispatcher 将其转发到不同的事件处理器上，如accept、read、send。<br><img src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAN6aUJebmReDkkjB5bvH9VPt3SFL7YAArELaxvvjBBWoqukEF6bwEwBAAMCAAN4AAM2BA.png"><br>综上，我们得出如下特性：</p>
<ul>
<li>单线程模式，内核持续监听 socket 上的连接及数据请求，一监听就交予Redis线程处理，达到单个线程处理多个I&#x2F;O 流的效果。</li>
<li>epoll 提供了基于事件的回调机制。不同事件调用对应的事件处理器。Redis可以持续性的高效处理事件，性能同步提升。</li>
<li>Redis 不阻塞任一客户端发起的请求，所以可以同时和多个客户端连接并处理请求，聚币并发执行的能力。</li>
</ul>
<h1 id="3-高性能Redis总结"><a href="#3-高性能Redis总结" class="headerlink" title="3 高性能Redis总结"></a>3 高性能Redis总结</h1><ul>
<li>基于内存实现，而非磁盘，大都是简单的存取操作，资源主要消耗在 IO 上，所以读取速度快。</li>
<li>数据结构：基于不同业务场景的高效数据结构<ul>
<li>动态字符串(REDIS_STRING)：整数(REDIS_ENCODING_INT)、字符串(REDIS_ENCODING_RAW)</li>
<li>双端列表(REDIS_ENCODING_LINKEDLIST)</li>
<li>压缩列表(REDIS_ENCODING_ZIPLIST)</li>
<li>跳跃表(REDIS_ENCODING_SKIPLIST)</li>
<li>哈希表(REDIS_HASH)</li>
<li>整数集合(REDIS_ENCODING_INTSET)</li>
</ul>
</li>
<li>线程模型：Redis 的网络 IO 以及键值对指令读写是由单个线程来执行的，避免了不必要的contextswitch和竞选</li>
<li>I&#x2F;O 模型：基于I&#x2F;O多路复用模型，非阻塞的I&#x2F;O模型</li>
<li>恰单的数据编码：根据实际数据类型，选择合理的数据编码</li>
<li>Redis 本身是一个全局 哈希表，他的时间复杂度是 O(1)，另外为了防止哈希冲突导致链表过长，执行 rehash 操作进行扩充，减少哈希冲突。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMCZ7HaLpZxDj_zG1XxJmHwfbAThfQAAqTEMRuvMJFV9E-PLlimPicBAAMCAAN4AAM2BA.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMCZ7HaLpZxDj_zG1XxJmHwfbAThfQAAqTEMRuvMJFV9E-PLlimPicBAAMCAAN4AAM2BA.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">dachang</div><div class="post-copyright__author_desc">感谢你选择与我一起虚度时光。</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/')">Redis系列1：深刻理解高性能Redis的本质</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMEZ7HheDSuPHt4eDeH2L1Y4ORfslsAArXEMRuvMJFVZbGWT1spGtgBAAMCAAN4AAM2BA.jpg" target="_blank"><img class="post-qr-code-img" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMEZ7HheDSuPHt4eDeH2L1Y4ORfslsAArXEMRuvMJFVZbGWT1spGtgBAAMCAAN4AAM2BA.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMFZ7Hh6gSTlGPMvEOEIQjcnW85WsUAArfEMRuvMJFV1ctnAAFzfhv0AQADAgADeAADNgQ.jpg" target="_blank"><img class="post-qr-code-img" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMFZ7Hh6gSTlGPMvEOEIQjcnW85WsUAArfEMRuvMJFV1ctnAAFzfhv0AQADAgADeAADNgQ.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Redis系列1：深刻理解高性能Redis的本质&amp;url=https://yeoh.de5.net/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%971-%E6%B7%B1%E5%88%BB%E7%90%86%E8%A7%A3%E9%AB%98%E6%80%A7%E8%83%BDRedis%E7%9A%84%E6%9C%AC%E8%B4%A8/&amp;pic=https://imags-563.pages.dev/file/AgACAgUAAxkDAANsaUJahYhmpT20C3buqSiwwIky_9gAAp8LaxvvjBBWtjzhzL6BcHEBAAMCAAN3AAM2BA.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://yeoh.de5.net" target="_blank">数根朽木，</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/Redis%E7%B3%BB%E5%88%97/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>Redis系列<span class="categoryesPageCount">5</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Redis/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Redis<span class="tagsPageCount">5</span></a><a class="post-meta__box__tags" href="/tags/Redis%E5%8E%9F%E7%90%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Redis原理<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://imags-563.pages.dev/file/AgACAgUAAxkDAAIBAmlH3SZw4NLnVFKHYP2CLXavRmtwAAIZC2sbp6dAVo74ckeE45n5AQADAgADeAADNgQ.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%9711-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/"><img class="prev-cover" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAOCaUJyji-IMAZryUvzqam01QmRvs8AAtoLaxvvjBBWGHkoVtjkPrkBAAMCAAN3AAM2BA.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Redis系列11：内存淘汰策略</div></div></a></div><div class="next-post pull-right"><a href="/2025/03/17/%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96/DNS%20%E6%B3%84%E6%BC%8F%E3%80%81CDN%20%E8%AE%BF%E9%97%AE%E4%BC%98%E5%8C%96%E4%B8%8E%20Fake%20IP/"><img class="next-cover" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAODaUJ6ZVw3RQ9ihwABIJ5Oh2jzWEJyAAL4C2sb74wQVveq9GrLOw6LAQADAgADdwADNgQ.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">是什么，为什么，怎么做? —— 谈谈 DNS 泄漏、CDN 访问优化与 Fake IP</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/03/20/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%97-%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" title="Redis系列：聊聊布隆过滤器"><img class="cover" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAOVaUNssHJpyoSvULXJ3mpEoLYGqToAAogLaxvvjBhWKAb4Q2NXvCABAAMCAAN3AAM2BA.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-20</div><div class="title">Redis系列：聊聊布隆过滤器</div></div></a></div><div><a href="/2025/03/20/Redis%E7%B3%BB%E5%88%97/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8E%9F%E7%90%86/" title="聊聊布隆过滤器（原理）"><img class="cover" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAOWaUNtQYKc-Drv_7naPYGp3xRUEl0AAokLaxvvjBhWQ2K1g3YGEk8BAAMCAAN5AAM2BA.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-20</div><div class="title">聊聊布隆过滤器（原理）</div></div></a></div><div><a href="/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%9711-%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" title="Redis系列11：内存淘汰策略"><img class="cover" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAOCaUJyji-IMAZryUvzqam01QmRvs8AAtoLaxvvjBBWGHkoVtjkPrkBAAMCAAN3AAM2BA.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-11</div><div class="title">Redis系列11：内存淘汰策略</div></div></a></div><div><a href="/2025/03/11/Redis%E7%B3%BB%E5%88%97/Redis%E7%B3%BB%E5%88%9714-%E4%BD%BF%E7%94%A8List%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="Redis系列14：使用List实现消息队列"><img class="cover" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAANlaUIziU-Bsh9lbn9JNmBQLD0O0WkAAmkLaxvvjBBW98Yxo9My5IUBAAMCAAN4AAM2BA.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-11</div><div class="title">Redis系列14：使用List实现消息队列</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">1 背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Redis%E9%AB%98%E6%95%88%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">2 Redis高效性能分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%AE%98%E7%BD%91%E7%9A%84%E6%80%A7%E8%83%BD%E6%8A%A5%E5%91%8A"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 官网的性能报告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%9F%BA%E4%BA%8E%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 基于内存实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E9%80%82%E9%85%8D%E5%A4%9A%E5%85%83%E5%9C%BA%E6%99%AF%E7%9A%84%E9%AB%98%E6%95%88%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 适配多元场景的高效数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-SDS-%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 SDS 简单动态字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-zipList-%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 zipList 压缩列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-linklist-%E5%8F%8C%E7%AB%AF%E5%88%97%E8%A1%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 linklist 双端列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-Hhash-%E5%AD%97%E5%85%B8"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 Hhash 字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-intset-%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88"><span class="toc-number">2.3.5.</span> <span class="toc-text">2.3.5 intset 整数集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-6-skipList%E8%B7%B3%E8%B7%83%E8%A1%A8"><span class="toc-number">2.3.6.</span> <span class="toc-text">2.3.6 skipList跳跃表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 单线程模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E4%B8%BA%E4%BD%95%E6%98%AF%E5%8D%95%E7%BA%BF%E7%A8%8B%EF%BC%9F"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 为何是单线程？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 单线程的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%90%A6%E6%9C%89%E6%95%88%E5%88%A9%E7%94%A8CPU"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3 单线程是否有效利用CPU</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-I-O-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 I&#x2F;O 多路复用模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-%E6%99%AE%E9%80%9A-I-O-%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 普通 I&#x2F;O 模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-I-O-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 I&#x2F;O 多路复用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%AB%98%E6%80%A7%E8%83%BDRedis%E6%80%BB%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">3 高性能Redis总结</span></a></li></ol></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:youngyang0220@gmail.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMCZ7HaLpZxDj_zG1XxJmHwfbAThfQAAqTEMRuvMJFV9E-PLlimPicBAAMCAAN4AAM2BA.jpg" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/dachang007" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" target="_blank" rel="noopener" href="https://docs.anheyu.com/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="图床工具" target="_blank" rel="noopener" href="https://imags-563.pages.dev">图床工具</a><a class="footer-item" title="在线烟花模拟器" target="_blank" rel="noopener" href="http://greatree.hidns.co">在线烟花模拟器</a><a class="footer-item" title="订阅转换" target="_blank" rel="noopener" href="https://suburl.v1.mk">订阅转换</a><a class="footer-item" title="在线简历生成" target="_blank" rel="noopener" href="https://imags-563.pages.dev">在线简历生成</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.Cloudflare.com/" style="margin-inline:5px" data-title="本站使用CloudFlare为静态资源提供CDN加速" title="本站使用CloudFlare为静态资源提供CDN加速"><img src="https://img.shields.io/badge/%E2%98%81CDN-CloudFlare-yellow" alt="本站使用CloudFlare为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2022 - 2025 By <a class="footer-bar-link" href="/" title="dachang" target="_blank">dachang</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (false) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: false,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (false) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">33</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网站项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://imags-563.pages.dev" title="个人博客"><img class="back-menu-item-icon" src="/favicon.ico" alt="个人博客"/><span class="back-menu-item-text">个人博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://imags-563.pages.dev" title="在线简历"><img class="back-menu-item-icon" src="/favicon.ico" alt="在线简历"/><span class="back-menu-item-text">在线简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">建设工具</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://imags-563.pages.dev" title="在线图床"><img class="back-menu-item-icon" src="/img/image.ico" alt="在线图床"/><span class="back-menu-item-text">在线图床</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://greatree.hidns.co" title="在线烟花模拟器"><img class="back-menu-item-icon" src="/img/Clash.Mini.png" alt="在线烟花模拟器"/><span class="back-menu-item-text">在线烟花模拟器</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://greatree.hidns.co" title="烟花模拟器"><img class="back-menu-item-icon" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAMMZ7Qfv1Xv2qvgqSVN7kNhRO_uzfgAAlvAMRtiZKBVrGT1Z6RPiX4BAAMCAANtAAM2BA.png" alt="烟花模拟器"/><span class="back-menu-item-text">烟花模拟器</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://pay.totalh.net/" title="三合一收款码"><img class="back-menu-item-icon" src="https://imags-563.pages.dev/file/AgACAgUAAxkDAAM8Z7WNYNdWdrYsas5PPFT8Di3493sAAgLKMRsEtalVDcfaakgTXPkBAAMCAAN4AAM2BA.png" alt="三合一收款码"/><span class="back-menu-item-text">三合一收款码</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 博客文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 全部文章</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 文章分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 所有标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 网站工具</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://imags-563.pages.dev"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 图床工具</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="http://greatree.hidns.co"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 烟花模拟器</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://suburl.v1.mk"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 订阅转换</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://imags-563.pages.dev"><span> 在线简历生成</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于我</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://imags-563.pages.dev"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 在线简历</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Boolean-filter/" style="font-size: 0.88rem;">Boolean filter<sup>2</sup></a><a href="/tags/DNS%E6%B3%84%E9%9C%B2/" style="font-size: 0.88rem;">DNS泄露<sup>1</sup></a><a href="/tags/Fake-IP/" style="font-size: 0.88rem;">Fake IP<sup>1</sup></a><a href="/tags/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 0.88rem;">JVM虚拟机<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>1</sup></a><a href="/tags/JavaSE/" style="font-size: 0.88rem;">JavaSE<sup>11</sup></a><a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 0.88rem;">Java基础<sup>11</sup></a><a href="/tags/Java%E6%A0%B8%E5%BF%83/" style="font-size: 0.88rem;">Java核心<sup>14</sup></a><a href="/tags/Java%E7%89%88%E6%9C%AC%E6%96%B0%E7%89%B9%E6%80%A7/" style="font-size: 0.88rem;">Java版本新特性<sup>2</sup></a><a href="/tags/MQ/" style="font-size: 0.88rem;">MQ<sup>2</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>10</sup></a><a href="/tags/OOM/" style="font-size: 0.88rem;">OOM<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size: 0.88rem;">RabbitMQ<sup>2</sup></a><a href="/tags/Redis/" style="font-size: 0.88rem;">Redis<sup>5</sup></a><a href="/tags/Redis%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5/" style="font-size: 0.88rem;">Redis内存淘汰策略<sup>1</sup></a><a href="/tags/Redis%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">Redis原理<sup>1</sup></a><a href="/tags/Redis%E7%BC%93%E5%AD%98/" style="font-size: 0.88rem;">Redis缓存<sup>1</sup></a><a href="/tags/RocketMQ/" style="font-size: 0.88rem;">RocketMQ<sup>2</sup></a><a href="/tags/SSM/" style="font-size: 0.88rem;">SSM<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>1</sup></a><a href="/tags/SpringBoot/" style="font-size: 0.88rem;">SpringBoot<sup>1</sup></a><a href="/tags/kafka/" style="font-size: 0.88rem;">kafka<sup>2</sup></a><a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">单例模式<sup>1</sup></a><a href="/tags/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/" style="font-size: 0.88rem;">布隆过滤器<sup>2</sup></a><a href="/tags/%E6%8E%A5%E5%8F%A3%E8%B6%85%E6%97%B6/" style="font-size: 0.88rem;">接口超时<sup>1</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">消息中间件<sup>2</sup></a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 0.88rem;">消息队列<sup>1</sup></a><a href="/tags/%E7%BA%BF%E4%B8%8A%E4%BA%8B%E6%95%85/" style="font-size: 0.88rem;">线上事故<sup>1</sup></a><a href="/tags/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9/" style="font-size: 0.88rem;">缓存雪崩<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96/" style="font-size: 0.88rem;">网络优化<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%BF%90%E7%BB%B4%E8%B0%83%E4%BC%98/" style="font-size: 0.88rem;">运维调优<sup>3</sup></a><a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">高并发<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-kohl-zeta.vercel.app',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://unpkg.com/twikoo@1.6.44/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-kohl-zeta.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo-kohl-zeta.vercel.app',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://unpkg.com/twikoo@1.6.44/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404')
  }
})</script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>